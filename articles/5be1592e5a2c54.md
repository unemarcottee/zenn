---
title: "present? ã‚’ã™ã‚‹ã¨ 'invalid byte sequence in UTF-8' ã¨ãªã‚‹"
emoji: 'ğŸ‘»'
type: 'tech' # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ['ruby']
published: true
---

# tl;dr

- present?/nil? ãŒå¸¸ã« nil? ã‚’ä»£æ›¿ã§ãã‚‹ã‚ã‘ã§ã¯ãªã„
  - å‹ã«æ°—ã‚’ã¤ã‘ã‚‹

## äº‹è±¡ã¨ã—ã¦ãŠããŸã“ã¨

- S3 ã«ä¿å­˜ã—ã¦ã„ã‚‹ PDF ã®æœ‰ç„¡ã‚’åˆ¤å®šã—ã‚ˆã†ã¨ã—ãŸ
- ãƒã‚±ãƒƒãƒˆã®ç‰¹å®šã®ã‚­ãƒ¼ã‹ã‚‰å–å¾—ã—ãŸãƒ‡ãƒ¼ã‚¿ã‚’ `present?` ã§åˆ¤å®šã—ã‚ˆã†ã¨ã—ãŸã¨ã“ã‚ 'invalid byte sequence in UTF-8' ã¨ãªã£ãŸ
  - NoSuchKey ã®ã¨ã nil ã¨ãªã‚‹ä»•çµ„ã¿ãŒåˆ¥é€”å­˜åœ¨

## ã‚³ãƒ¼ãƒ‰ãƒªãƒ¼ãƒ‡ã‚£ãƒ³ã‚°

### present?

` present?`` ã¯  `blank?` ã®åå¯¾ã«ã‚ˆã£ã¦å®šç¾©ã•ã‚Œã¾ã™

https://github.com/rails/rails/blob/358d3d3164bef399b19b089f5fed8664a2c3d39e/activesupport/lib/active_support/core_ext/object/blank.rb#L22-L27

### blank?

blank? ã¯å„ class ã«å¯¾ã—ã¦æŒ¿å…¥ã•ã‚Œã‚‹ãŒã€ä»Šå›ã¯ String å‹ã ã£ãŸãŸã‚æ­£è¦è¡¨ç¾ãƒãƒƒãƒãŒå®Ÿæ–½ã•ã‚Œ UTF-8 æ–‡å­—åˆ—ã§ãªã„ãŸã‚ã‚¨ãƒ©ãƒ¼ã¨ãªã£ãŸ

https://github.com/rails/rails/blob/358d3d3164bef399b19b089f5fed8664a2c3d39e/activesupport/lib/active_support/core_ext/object/blank.rb#L103-L132

### ãªãœ String ã«ãªã£ãŸã®ã‹

AWS SDK ã§ S3 ã‹ã‚‰ get ã—ãŸ body ãŒ `String | StirngIO | File` ã§ã“ã‚Œã‚’ [read](https://docs.ruby-lang.org/ja/latest/method/IO/i/read.html) ã—ã¦ã„ãŸã€‚

[API ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](<https://docs.aws.amazon.com/sdk-for-ruby/v3/api/Aws/S3/Object.html#:~:text=%3Abody%20(String%2C%20StringIO%2C%20File)%20%E2%80%94%20Object%20data.>)ã‚ˆã‚Š

```text
:body (String, StringIO, File) â€” Object data.
```

## å¯¾å¿œç­–

- `nil?` ã§å¯¾å¿œã§ãã¾ã—ãŸã€‚

## ã¾ã¨ã‚

- å‹ã«å¯¾ã™ã‚‹èªè­˜ãŒç”˜ã‹ã£ãŸ

## å‚è€ƒ

- [Object#present?ã‚„#blank?ã§ invalid Byte Sequence in UTF 8 ã«ãªã‚‹æ™‚ã®å¯¾å‡¦æ³•](https://hack.ironsand.net/2022/present%E3%82%84blank%E3%81%A7invalid-byte-sequence-in-utf-8%E3%81%AB%E3%81%AA%E3%82%8B%E6%99%82%E3%81%AE%E5%AF%BE%E5%87%A6%E6%B3%95/)
  - ã»ã¼åŒã˜ã“ã¨ã‚’ã‹ã„ã¦ãŸã€‚ã²ã¨ã¨ãŠã‚Šæ›¸ã„ãŸå¾Œã«æ°—ä»˜ã„ãŸã€‚
- [Turbo 8 is dropping TypeScript](https://world.hey.com/dhh/turbo-8-is-dropping-typescript-70165c01)
